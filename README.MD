# ECG-Classification
ÄÃ¢y lÃ  cÃ¡c model dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i nhá»‹p tim ecg,sá»­ dá»¥ng cÃ¡c máº¡ng cnn,rnn,attention mode

DATA SETCG-Classification
ÄÃ¢y lÃ  cÃ¡c model dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i nhá»‹p tim ecg,sá»­ dá»¥ng cÃ¡c máº¡ng cnn,rnn,attention mode

DATA SET gÃ´c Ä‘Æ°á»£c láº¥y tá»« https://www.kaggle.com/code/polomarco/ecg-classification-cnn-lstm-attention-mechanism/input

Bá»™ dá»¯ liá»‡u phÃ¢n loáº¡i nhá»‹p tim ECG

## TÃ³m táº¯t

Bá»™ dá»¯ liá»‡u nÃ y bao gá»“m hai bá»™ sÆ°u táº­p tÃ­n hiá»‡u nhá»‹p tim Ä‘Æ°á»£c láº¥y tá»« hai bá»™ dá»¯ liá»‡u ná»•i tiáº¿ng trong phÃ¢n loáº¡i nhá»‹p tim: Bá»™ dá»¯ liá»‡u loáº¡n nhá»‹p tim MIT-BIH vÃ  CÆ¡ sá»Ÿ dá»¯ liá»‡u ECG cháº©n Ä‘oÃ¡n PTB . Sá»‘ lÆ°á»£ng máº«u trong cáº£ hai bá»™ sÆ°u táº­p Ä‘á»u Ä‘á»§ lá»›n Ä‘á»ƒ huáº¥n luyá»‡n má»™t máº¡ng nÆ¡-ron sÃ¢u.

Bá»™ dá»¯ liá»‡u nÃ y Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khÃ¡m phÃ¡ phÃ¢n loáº¡i nhá»‹p tim báº±ng kiáº¿n trÃºc máº¡ng nÆ¡-ron sÃ¢u vÃ  quan sÃ¡t má»™t sá»‘ kháº£ nÄƒng cá»§a há»c chuyá»ƒn giao trÃªn Ä‘Ã³. CÃ¡c tÃ­n hiá»‡u tÆ°Æ¡ng á»©ng vá»›i hÃ¬nh dáº¡ng Ä‘iá»‡n tÃ¢m Ä‘á»“ (ECG) cá»§a nhá»‹p tim trong trÆ°á»ng há»£p bÃ¬nh thÆ°á»ng vÃ  cÃ¡c trÆ°á»ng há»£p bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c rá»‘i loáº¡n nhá»‹p tim vÃ  nhá»“i mÃ¡u cÆ¡ tim khÃ¡c nhau. CÃ¡c tÃ­n hiá»‡u nÃ y Ä‘Æ°á»£c xá»­ lÃ½ sÆ¡ bá»™ vÃ  phÃ¢n Ä‘oáº¡n, vá»›i má»—i phÃ¢n Ä‘oáº¡n tÆ°Æ¡ng á»©ng vá»›i má»™t nhá»‹p tim.

### Ná»™i dung

**Bá»™ dá»¯ liá»‡u loáº¡n nhá»‹p tim**
* Sá»‘ lÆ°á»£ng máº«u: 109446
* Sá»‘ lÆ°á»£ng danh má»¥c: 5
* Táº§n sá»‘ láº¥y máº«u: 125Hz
* Nguá»“n dá»¯ liá»‡u: Bá»™ dá»¯ liá»‡u rá»‘i loáº¡n nhá»‹p tim MIT-BIH cá»§a Physionet
* CÃ¡c lá»›p: ['N': 0, 'S': 1, 'V': 2, 'F': 3, 'Q': 4]
* CÆ¡ sá»Ÿ dá»¯ liá»‡u ECG cháº©n Ä‘oÃ¡n PTB
* Sá»‘ lÆ°á»£ng máº«u: 14552
* Sá»‘ lÆ°á»£ng danh má»¥c: 2
* Táº§n sá»‘ láº¥y máº«u: 125Hz
* Nguá»“n dá»¯ liá»‡u: CÆ¡ sá»Ÿ dá»¯ liá»‡u cháº©n Ä‘oÃ¡n PTB cá»§a Physionet
* LÆ°u Ã½ : Táº¥t cáº£ cÃ¡c máº«u Ä‘á»u Ä‘Æ°á»£c cáº¯t, giáº£m máº«u vÃ  thÃªm sá»‘ khÃ´ng náº¿u cáº§n thiáº¿t theo kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh lÃ  188 .

Tá»‡p dá»¯ liá»‡u

Bá»™ dá»¯ liá»‡u nÃ y bao gá»“m má»™t loáº¡t cÃ¡c tá»‡p CSV. Má»—i tá»‡p CSV chá»©a má»™t ma tráº­n, vá»›i má»—i hÃ ng Ä‘áº¡i diá»‡n cho má»™t vÃ­ dá»¥ trong pháº§n Ä‘Ã³ cá»§a bá»™ dá»¯ liá»‡u. Pháº§n tá»­ cuá»‘i cÃ¹ng cá»§a má»—i hÃ ng biá»ƒu thá»‹ lá»›p mÃ  vÃ­ dá»¥ Ä‘Ã³ thuá»™c vá».

MÃ´i 1 tÃ­n hiÃªu ecg cÃ³ 188 featu-Classification
ÄÃ¢y lÃ  cÃ¡c model dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i nhá»‹p tim ecg,sá»­ dá»¥ng cÃ¡c máº¡ng cnn,rnn,attention mode

DATA SETCG-Classification
ÄÃ¢y lÃ  cÃ¡c model dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i nhá»‹p tim ecg,sá»­ dá»¥ng cÃ¡c máº¡ng cnn,rnn,attention mode

DATA SET gÃ´c Ä‘Æ°á»£c láº¥y tá»« https://www.kaggle.com/code/polomarco/ecg-classification-cnn-lstm-attention-mechanism/input

Bá»™ dá»¯ liá»‡u phÃ¢n loáº¡i nhá»‹p tim ECG
TÃ³m táº¯t
Bá»™ dá»¯ liá»‡u nÃ y bao gá»“m hai bá»™ sÆ°u táº­p tÃ­n hiá»‡u nhá»‹p tim Ä‘Æ°á»£c láº¥y tá»« hai bá»™ dá»¯ liá»‡u ná»•i tiáº¿ng trong phÃ¢n loáº¡i nhá»‹p tim: Bá»™ dá»¯ liá»‡u loáº¡n nhá»‹p tim MIT-BIH vÃ  CÆ¡ sá»Ÿ dá»¯ liá»‡u ECG cháº©n Ä‘oÃ¡n PTB . Sá»‘ lÆ°á»£ng máº«u trong cáº£ hai bá»™ sÆ°u táº­p Ä‘á»u Ä‘á»§ lá»›n Ä‘á»ƒ huáº¥n luyá»‡n má»™t máº¡ng nÆ¡-ron sÃ¢u.

Bá»™ dá»¯ liá»‡u nÃ y Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khÃ¡m phÃ¡ phÃ¢n loáº¡i nhá»‹p tim báº±ng kiáº¿n trÃºc máº¡ng nÆ¡-ron sÃ¢u vÃ  quan sÃ¡t má»™t sá»‘ kháº£ nÄƒng cá»§a há»c chuyá»ƒn giao trÃªn Ä‘Ã³. CÃ¡c tÃ­n hiá»‡u tÆ°Æ¡ng á»©ng vá»›i hÃ¬nh dáº¡ng Ä‘iá»‡n tÃ¢m Ä‘á»“ (ECG) cá»§a nhá»‹p tim trong trÆ°á»ng há»£p bÃ¬nh thÆ°á»ng vÃ  cÃ¡c trÆ°á»ng há»£p bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi cÃ¡c rá»‘i loáº¡n nhá»‹p tim vÃ  nhá»“i mÃ¡u cÆ¡ tim khÃ¡c nhau. CÃ¡c tÃ­n hiá»‡u nÃ y Ä‘Æ°á»£c xá»­ lÃ½ sÆ¡ bá»™ vÃ  phÃ¢n Ä‘oáº¡n, vá»›i má»—i phÃ¢n Ä‘oáº¡n tÆ°Æ¡ng á»©ng vá»›i má»™t nhá»‹p tim.

Ná»™i dung
Bá»™ dá»¯ liá»‡u loáº¡n nhá»‹p tim
Sá»‘ lÆ°á»£ng máº«u: 109446
Sá»‘ lÆ°á»£ng danh má»¥c: 5
Táº§n sá»‘ láº¥y máº«u: 125Hz
Nguá»“n dá»¯ liá»‡u: Bá»™ dá»¯ liá»‡u rá»‘i loáº¡n nhá»‹p tim MIT-BIH cá»§a Physionet
CÃ¡c lá»›p: ['N': 0, 'S': 1, 'V': 2, 'F': 3, 'Q': 4]
CÆ¡ sá»Ÿ dá»¯ liá»‡u ECG cháº©n Ä‘oÃ¡n PTB
Sá»‘ lÆ°á»£ng máº«u: 14552
Sá»‘ lÆ°á»£ng danh má»¥c: 2
Táº§n sá»‘ láº¥y máº«u: 125Hz
Nguá»“n dá»¯ liá»‡u: CÆ¡ sá»Ÿ dá»¯ liá»‡u cháº©n Ä‘oÃ¡n PTB cá»§a Physionet
LÆ°u Ã½ : Táº¥t cáº£ cÃ¡c máº«u Ä‘á»u Ä‘Æ°á»£c cáº¯t, giáº£m máº«u vÃ  thÃªm sá»‘ khÃ´ng náº¿u cáº§n thiáº¿t theo kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh lÃ  188 .

Tá»‡p dá»¯ liá»‡u
Bá»™ dá»¯ liá»‡u nÃ y bao gá»“m má»™t loáº¡t cÃ¡c tá»‡p CSV. Má»—i tá»‡p CSV chá»©a má»™t ma tráº­n, vá»›i má»—i hÃ ng Ä‘áº¡i diá»‡n cho má»™t vÃ­ dá»¥ trong pháº§n Ä‘Ã³ cá»§a bá»™ dá»¯ liá»‡u. Pháº§n tá»­ cuá»‘i cÃ¹ng cá»§a má»—i hÃ ng biá»ƒu thá»‹ lá»›p mÃ  vÃ­ dá»¥ Ä‘Ã³ thuá»™c vá».

MÃ´i 1 tÃ­n hiÃªu ecg cÃ³ 188 feature
Trong Ä‘Ã³ 187 Ä‘iá»ƒm Ä‘iá»u chÃ­nh lÃ  giÃ¡ trá»‹ cá»§a tÃ­n hiá»‡u Ä‘Ã³ theo Ä‘iá»ƒm thá»i gian.Giá»“ng nhÆ° 1 video 30 giÃ¢y Ä‘Æ°á»£c chia thÃ nh 30 input Xi.

Äáº·c trÆ°ng cuá»‘i cÃ¹ng sáº½ lÃ  nhÃ£n cá»§a nÃ³ Ä‘Æ°á»£c Ä‘Ã¡nh sá»‘ tá»« 0 Ä‘áº¿n 4.Äá»ƒ phÃ¢n loáº¡i ta sáº½ pháº£i gÃ¡n láº¡i nhÃ£n tÆ°Æ¡ng á»©ng theo sá»‘.

id_to_label = {
    0: "Normal",
    1: "Artial Premature",
    2: "Premature ventricular contraction",
    3: "Fusion of ventricular and normal",
    4: "Fusion of paced and normal"
}

Sau Ä‘Ã¢y lÃ  biá»ƒu Ä‘á»“ phÃ¢n bá»‘ dá»¯ liá»‡u:
![img.png](img.png)
Ta tháº¥y data set trÃªn bá»‹ imbalance khÃ¡ náº·ng.Äiá»u nÃ y gÃ¢y ra hiá»‡n tÆ°á»£ng Ä‘á»™ chÃ­nh xÃ¡c tá»•ng thÃª cá»§a model phÃ¢n loáº¡i sáº½ khÃ¡ cao nhÆ°ng Ä‘á»™ chÃ­nh xÃ¡c trÃªn tá»«ng nhÃ£n cÃ³ thá»ƒ khÃ¡ tháº¥p.Tuy nhiÃªn model Ä‘Æ°á»£c coi lÃ  tá»‘t náº¿u Ä‘á»™  chÃ­nh xÃ¡c trÃªn cÃ¡c nhÃ£n bá»‹ Ã­t dá»¯ liá»‡u cÅ©ng ráº¥t cao.

HÆ°á»›ng dáº«n cháº¡y:

Táº£i tá»«ng file trong data set vá» rá»“i thay láº¡i Ä‘Æ°á»ng link khai bÃ¡o data trong note book:
![img_1.png](img_1.png)
![img_2.png](img_2.png)
Sau Ä‘Ã³ cháº¡y tá»«ng block trong note book .Trong Ä‘Ã³ Ä‘á»£i model train xong vÃ  in bÃ¡o cÃ¡o:
![img_3.png](img_3.png)

PhÃ¢n tÃ­ch cÃ´ng viá»‡c Ä‘Ã£ lÃ m:

Viá»‡c cá»§a em Ä‘Ã£ lÃ m lÃ  dá»±a vÃ o báº£n thiáº¿t káº¿ kiáº¿n trÃºc trÃªn Ä‘á»ƒ dá»¥ng láº¡i tá»«ng layer báº±ng thÆ° viá»‡n pytorch.Qua Ä‘Ã³ hiá»ƒu Ä‘Æ°á»£c cÃ¡ch build vÃ  tuá»³ chá»‰nh thiáº¿t káº¿ 1 model hÃ¬nh.Em Ä‘Ã£ build vÃ  train tá»•ng cá»™ng 3 model trong báº£n thiáº¿t káº¿t trÃªn:

![img_4.png](img_4.png)
Trong Ä‘Ã³ kiáº¿n trÃºc trong 1 class Ä‘Æ°á»£c chia thÃ nh 2 pháº§n 1 pháº§n dÃ¹ng Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c phÃ©p toÃ¡n cÃ³ trong layer biá»ƒu Ä‘á»“ trÃªn,cÃ²n táº¥t cáº£ thá»±c hiá»‡n thuáº­t toÃ¡n tráº£ vá» giÃ¡ trá»‹ Ä‘á»u Ä‘Æ°á»£c thá»±c hiá»‡n trong hÃ m def forward:
![img_5.png](img_5.png)
Má»—i má»™t model Ä‘á»u cÃ³ 1 phÃ©p toÃ¡n cuá»‘i sofmax.TÃºc lÃ  táº¥t cáº£ cÃ¡c model Ä‘á»u biáº¿n cÃ¡c input Ä‘áº§u vÃ o lÃ  cÃ¡c vector sofmax cÃ³ 5 chiá»u vÃ¬ ta cÃ³ 5 nhÃ£n:

Giáº£ sá»­ ta cÃ³ vector sofmax sau:
[0.45,0.15,0.1,0.2,0.1].

Tá»©c lÃ  tÃ­n hiá»‡u cÃ³ 45% lÃ  thuá»™c nhÃ£n 0,15% nhÃ£n 1,..

Sau Ä‘Ã³ em xÃ¢y dá»±ng hÃ m trainer vÃ  metric Ä‘á»ƒ trÃ­ch xuáº¥t thÃ´ng tin sau má»—i epoch.Tá»‡p data set Ä‘Æ°á»£c chia thÃ nh 85% train vÃ  15% val.Má»—i epoch cÃ³ 2 pha 1 pha cháº¡y trÃªn tá»‡p train ,1 pha Ä‘Ã¡nh giÃ¡ trÃªn tá»‡p val :
![img_6.png](img_6.png)
**3 chá»‰ sá»‘ ngoÃ i cÃ¹ng cÃ³ nghÄ©a lÃ  :**

ğŸ¯ 1ï¸âƒ£ accuracy avg

â€¢	Ã nghÄ©a: ÄÃ¢y lÃ  Ä‘á»™ chÃ­nh xÃ¡c tá»•ng thá»ƒ (overall accuracy).

â€¢	GiÃ¡ trá»‹ nÃ y chá»‰ ra tá»· lá»‡ pháº§n trÄƒm cÃ¡c máº«u mÃ  mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n Ä‘Ãºng trÃªn toÃ n bá»™ dataset.
________________________________________
ğŸ¯ 2ï¸âƒ£ macro avg

â€¢	Ã nghÄ©a: ÄÃ¢y lÃ  macro-average â€” tÃ­nh trung bÃ¬nh cÃ¡c chá»‰ sá»‘ (precision, recall, F1) cho táº¥t cáº£ cÃ¡c class, mÃ  khÃ´ng xÃ©t Ä‘áº¿n tá»· lá»‡ xuáº¥t hiá»‡n cá»§a má»—i class.

â€¢	CÃ¡ch tÃ­nh:
1. TÃ­nh precision, recall, F1 cho tá»«ng class riÃªng.
2. Sau Ä‘Ã³ láº¥y trung bÃ¬nh cá»™ng cá»§a táº¥t cáº£ cÃ¡c class.

â€¢	Khi nÃ o quan trá»ng:
Macro avg há»¯u Ã­ch khi báº¡n muá»‘n xem mÃ´ hÃ¬nh hoáº¡t Ä‘á»™ng cÃ´ng báº±ng tháº¿ nÃ o giá»¯a cÃ¡c class, Ä‘áº·c biá»‡t náº¿u dataset bá»‹ máº¥t cÃ¢n báº±ng.
________________________________________
ğŸ¯ 3ï¸âƒ£ weighted avg

â€¢	Ã nghÄ©a: ÄÃ¢y lÃ  weighted-average â€” cÅ©ng tÃ­nh trung bÃ¬nh cÃ¡c chá»‰ sá»‘ cho táº¥t cáº£ cÃ¡c class nhÆ°ng cÃ³ tÃ­nh Ä‘áº¿n tá»· lá»‡ máº«u cá»§a tá»«ng class.

â€¢	CÃ¡ch tÃ­nh:
1. TÃ­nh precision, recall, F1 cho tá»«ng class.
2. Má»—i class Ä‘Æ°á»£c cÃ¢n trá»ng sá»‘ theo sá»‘ máº«u thá»±c táº¿ cá»§a class Ä‘Ã³.

â€¢	Khi nÃ o quan trá»ng:
Weighted avg cho biáº¿t hiá»‡u suáº¥t chung thá»±c táº¿, pháº£n Ã¡nh rÃµ hÆ¡n vá»›i dataset máº¥t cÃ¢n báº±ng vÃ¬ nÃ³ Æ°u tiÃªn nhá»¯ng class lá»›n.


 **CÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡:**
 
**1.Precision**

* Ã nghÄ©a: Trong sá»‘ cÃ¡c máº«u dá»± Ä‘oÃ¡n lÃ  Positive, cÃ³ bao nhiÃªu máº«u tháº­t sá»± Ä‘Ãºng.

* CÃ´ng thá»©c: Precision = TP / (TP + FP)

  * TP = True Positive (Dá»± Ä‘oÃ¡n Ä‘Ãºng Positive)
  * FP = False Positive (Dá»± Ä‘oÃ¡n sai Positive)

**2.Recall**

* Ã nghÄ©a: Trong sá»‘ cÃ¡c máº«u tháº­t sá»± lÃ  Positive, mÃ´ hÃ¬nh phÃ¡t hiá»‡n ra bao nhiÃªu.

* CÃ´ng thá»©c: Recall = TP / (TP + FN)
  * TP = True Positive
  * FN = False Negative (Bá» sÃ³t, dá»± Ä‘oÃ¡n sai lÃ  Negative)

**3.F1-score**

* Ã nghÄ©a: Trung bÃ¬nh Ä‘iá»u hÃ²a giá»¯a Precision vÃ  Recall. CÃ¢n báº±ng giá»¯a viá»‡c dá»± Ä‘oÃ¡n Ä‘Ãºng Positive vÃ  báº¯t Ä‘Æ°á»£c háº¿t Positive.

* CÃ´ng thá»©c: F1 = 2 * (Precision * Recall) / (Precision + Recall)

**ÄÃ¡nh giÃ¡:**

-Æ¯u Ä‘iá»ƒm:

* Táº¥t cáº£ cÃ¡c model Ä‘á»u cho ra Ä‘á»™ chÃ­nh xÃ¡c vÃ  Ä‘á»™ phá»§ cao vá»›i 1 nháº«n báº¥t cháº¥p bá»‹ máº¥t cÃ¢n báº±ng dá»¯ liá»‡u.
Äiá»u Ä‘Ã³ cho tháº¥y model cÃ³ sá»± nhÃ¢n diá»‡n cÃ¡c nhÃ£n ráº¥t hiá»‡u quáº£.

* Model cÅ©ng khng há» cÃ³ dáº¥u hiá»‡u bá»‹ overfitting,cÃ¡c chá»‰ sá»‘ Ä‘Ã¡nh giÃ¡ á»u tÄƒng sau má»—i epoch cáº£ trÃªn táº­p train vÃ  test.
![img_7.png](img_7.png)
-Háº¡n cháº¿ :

* Váº«n chÆ°a tá»‘i Æ°u Ä‘Æ°á»£c 2 model sá»­ dá»¥ng rnn vÃ  attention mode.NÃªn cho dÃ¹ chá»‰ sá»‘ cÃ¡c model nÃ y váº«n ráº¥t cao nhÆ°ng láº¡i khÃ´ng hiá»‡u quáº£ báº±ng CNN model,do sá»­ dá»¥ng cÃ¡c phÃ©p toÃ¡n nháº¹ nÃªn tÃ­nh toÃ¡n nhanh hÆ¡n.

**TÃ­nh cháº¥t dá»± Ã¡n:**

ÄÃ¢y lÃ  dá»± Ã¡n cÃ¡ nhÃ¢n.